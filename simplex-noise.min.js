let SQRT3=Math.sqrt(3),SQRT5=Math.sqrt(5),F2=.5*(SQRT3-1),G2=(3-SQRT3)/6,F3=1/3,G3=1/6,F4=(SQRT5-1)/4,G4=(5-SQRT5)/20,fastFloor=_=>0|Math.floor(_),grad2=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),grad3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);export function createNoise2D(_=Math.random){let $=buildPermutationTable(_),e=new Float64Array($).map(_=>grad2[_%12*2]),t=new Float64Array($).map(_=>grad2[_%12*2+1]);return function _(l,r){let o=0,a=0,n=0,G=(l+r)*F2,f=fastFloor(l+G),i=fastFloor(r+G),s=(f+i)*G2,u=l-(f-s),d=r-(i-s),m,F;u>d?(m=1,F=0):(m=0,F=1);let p=u-m+G2,w=d-F+G2,g=u-1+2*G2,c=d-1+2*G2,T=255&f,b=255&i,Q=.5-u*u-d*d;if(Q>=0){let R=T+$[b],S=e[R],x=t[R];Q*=Q,o=Q*Q*(S*u+x*d)}let P=.5-p*p-w*w;if(P>=0){let D=T+m+$[b+F],N=e[D],q=t[D];P*=P,a=P*P*(N*p+q*w)}let h=.5-g*g-c*c;if(h>=0){let j=T+1+$[b+1],k=e[j],v=t[j];h*=h,n=h*h*(k*g+v*c)}return 70*(o+a+n)}}export function createNoise3D(_=Math.random){let $=buildPermutationTable(_),e=new Float64Array($).map(_=>grad3[_%12*3]),t=new Float64Array($).map(_=>grad3[_%12*3+1]),l=new Float64Array($).map(_=>grad3[_%12*3+2]);return function _(r,o,a){let n,G,f,i,s=(r+o+a)*F3,u=fastFloor(r+s),d=fastFloor(o+s),m=fastFloor(a+s),F=(u+d+m)*G3,p=r-(u-F),w=o-(d-F),g=a-(m-F),c,T,b,Q,R,S;p>=w?w>=g?(c=1,T=0,b=0,Q=1,R=1,S=0):p>=g?(c=1,T=0,b=0,Q=1,R=0,S=1):(c=0,T=0,b=1,Q=1,R=0,S=1):w<g?(c=0,T=0,b=1,Q=0,R=1,S=1):p<g?(c=0,T=1,b=0,Q=0,R=1,S=1):(c=0,T=1,b=0,Q=1,R=1,S=0);let x=p-c+G3,P=w-T+G3,D=g-b+G3,N=p-Q+2*G3,q=w-R+2*G3,h=g-S+2*G3,j=p-1+3*G3,k=w-1+3*G3,v=g-1+3*G3,y=255&u,z=255&d,A=255&m,B=.6-p*p-w*w-g*g;if(B<0)n=0;else{let C=y+$[z+$[A]];B*=B,n=B*B*(e[C]*p+t[C]*w+l[C]*g)}let E=.6-x*x-P*P-D*D;if(E<0)G=0;else{let H=y+c+$[z+T+$[A+b]];E*=E,G=E*E*(e[H]*x+t[H]*P+l[H]*D)}let I=.6-N*N-q*q-h*h;if(I<0)f=0;else{let J=y+Q+$[z+R+$[A+S]];I*=I,f=I*I*(e[J]*N+t[J]*q+l[J]*h)}let K=.6-j*j-k*k-v*v;if(K<0)i=0;else{let L=y+1+$[z+1+$[A+1]];K*=K,i=K*K*(e[L]*j+t[L]*k+l[L]*v)}return 32*(n+G+f+i)}}export function createNoise4D(_=Math.random){let $=buildPermutationTable(_),e=new Float64Array($).map(_=>grad4[_%32*4]),t=new Float64Array($).map(_=>grad4[_%32*4+1]),l=new Float64Array($).map(_=>grad4[_%32*4+2]),r=new Float64Array($).map(_=>grad4[_%32*4+3]);return function _(o,a,n,G){let f,i,s,u,d,m=(o+a+n+G)*F4,F=fastFloor(o+m),p=fastFloor(a+m),w=fastFloor(n+m),g=fastFloor(G+m),c=(F+p+w+g)*G4,T=o-(F-c),b=a-(p-c),Q=n-(w-c),R=G-(g-c),S=0,x=0,P=0,D=0;T>b?S++:x++,T>Q?S++:P++,T>R?S++:D++,b>Q?x++:P++,b>R?x++:D++,Q>R?P++:D++;let N=S>=3?1:0,q=x>=3?1:0,h=P>=3?1:0,j=D>=3?1:0,k=S>=2?1:0,v=x>=2?1:0,y=P>=2?1:0,z=D>=2?1:0,A=S>=1?1:0,B=x>=1?1:0,C=P>=1?1:0,E=D>=1?1:0,H=T-N+G4,I=b-q+G4,J=Q-h+G4,K=R-j+G4,L=T-k+2*G4,M=b-v+2*G4,O=Q-y+2*G4,U=R-z+2*G4,V=T-A+3*G4,W=b-B+3*G4,X=Q-C+3*G4,Y=R-E+3*G4,Z=T-1+4*G4,__=b-1+4*G4,_$=Q-1+4*G4,_e=R-1+4*G4,_t=255&F,_l=255&p,_0=255&w,_r=255&g,_o=.6-T*T-b*b-Q*Q-R*R;if(_o<0)f=0;else{let _a=_t+$[_l+$[_0+$[_r]]];_o*=_o,f=_o*_o*(e[_a]*T+t[_a]*b+l[_a]*Q+r[_a]*R)}let _1=.6-H*H-I*I-J*J-K*K;if(_1<0)i=0;else{let _n=_t+N+$[_l+q+$[_0+h+$[_r+j]]];_1*=_1,i=_1*_1*(e[_n]*H+t[_n]*I+l[_n]*J+r[_n]*K)}let _G=.6-L*L-M*M-O*O-U*U;if(_G<0)s=0;else{let _2=_t+k+$[_l+v+$[_0+y+$[_r+z]]];_G*=_G,s=_G*_G*(e[_2]*L+t[_2]*M+l[_2]*O+r[_2]*U)}let _3=.6-V*V-W*W-X*X-Y*Y;if(_3<0)u=0;else{let _f=_t+A+$[_l+B+$[_0+C+$[_r+E]]];_3*=_3,u=_3*_3*(e[_f]*V+t[_f]*W+l[_f]*X+r[_f]*Y)}let _i=.6-Z*Z-__*__-_$*_$-_e*_e;if(_i<0)d=0;else{let _s=_t+1+$[_l+1+$[_0+1+$[_r+1]]];_i*=_i,d=_i*_i*(e[_s]*Z+t[_s]*__+l[_s]*_$+r[_s]*_e)}return 27*(f+i+s+u+d)}}export function buildPermutationTable(_){let $=new Uint8Array(512);for(let e=0;e<256;e++)$[e]=e;for(let t=0;t<255;t++){let l=t+~~(_()*(256-t)),r=$[t];$[t]=$[l],$[l]=r}for(let o=256;o<512;o++)$[o]=$[o-256];return $}